{{- $pc := .Site.Config.Privacy.Disqus -}}
{{- if not $pc.Disable -}}
{{ if .Site.DisqusShortname }}
{{ $url := urls.Parse .Params.relcanonical }}
{{ $path := path.Base $url.Path }}
{{- /*
  We are using .Params.relcanonical for content originally from a different website since relcanonical should point to
    the original website.
  The disqus_url param must be the same as the relcanonical as it uses this for links within the disqus platform.
*/ -}}
<div id="disqus_thread"></div>
<script type="application/javascript">
  var disqus_config = function () {
    {{/* {{ with or (.Params.disqus_identifier) ($url.Path) }}this.page.identifier = '{{ . | urlize }}';{{ end }} */}}
    {{ with or (.Params.disqus_identifier) ($path) }}this.page.identifier = '{{ . }}';{{ end }}
    {{ with or (.Params.disqus_title) (.Title ) }}this.page.title = '{{ . }}';{{ end }}
    {{ with or (.Params.relcanonical) (.Params.disqus_url) (.Permalink) }}this.page.url = '{{ . | html  }}';{{ end }}
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script');
    s.async = true;
    s.src = 'https://' + {{ .Site.DisqusShortname }} + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>{{end}}
{{- end -}}
